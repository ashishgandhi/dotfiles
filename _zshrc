# Customize
PROMPT='❯ '
ZLE_REMOVE_SUFFIX_CHARS=' \t\n;&)'
setopt CORRECT

# History
setopt EXTENDED_HISTORY
setopt INC_APPEND_HISTORY_TIME
HISTFILE="${HOME}/.zsh_history"
HISTSIZE=10000
SAVEHIST=10000

# Tools
source '/opt/homebrew/opt/fzf/shell/key-bindings.zsh'
source '/opt/homebrew/opt/fzf/shell/completion.zsh'
source "${HOME}/.iterm2_shell_integration.zsh"
eval "$(fasd --init auto)"

# Completion
zstyle ':completion:*' menu select
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' 'r:|[._-]=* r:|=*' 'l:|=* r:|=*'
autoload -Uz compinit
for dump in ~/.zcompdump(N.mh+24); do
  compinit -u
done
compinit -C

# Aliases
alias j='fasd_cd -i'
alias ls='ls -G'
alias grep='grep -E --color=auto'
alias fgrep='grep -F'
alias mgl="git log --oneline --author='Ashish Gandhi'"
alias f='mdfind -onlyin .'
alias h='fc -liD'
alias yd="youtube-dl -f 'best[ext=mp4]'"
alias ybest="youtube-dl -f 'bestvideo[ext=mp4]+bestaudio[ext=m4a]/mp4'"
alias jsc="/System/Library/Frameworks/JavaScriptCore.framework/Versions/Current/Helpers/jsc"

# Dropbox
alias m='ssh -A mustang'
alias t='ssh -CNfAD 8080 mustang'

alias gestalt='mbzl tool //dropbox/yaps/gestalt'

alias ad='arc diff origin/master'
alias al='arc land --onto master --fast-lane'
alias adl='ad && al'

function awscreds {
    tokens=/tmp/tokens.json
    if [ -z "$1" ]
    then
        echo "MFA token needed"
        return 1
    fi
    aws sts get-session-token --serial-number arn:aws:iam::495839769800:mfa/ashishg_mfa --token-code $1 > $tokens
    if ! [ $? -eq '0' ]
    then
        echo "Failed to get AWS credentials"
        return 1
    fi
    export AWS_ACCESS_KEY_ID=$(jq -r .Credentials.AccessKeyId $tokens)
    export AWS_SECRET_ACCESS_KEY=$(jq -r .Credentials.SecretAccessKey $tokens)
    export AWS_SESSION_TOKEN=$(jq -r .Credentials.SessionToken $tokens)
    rm $tokens
}
